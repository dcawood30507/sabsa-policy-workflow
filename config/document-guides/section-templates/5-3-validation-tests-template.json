{
  "sectionId": "5-3",
  "layerId": "component",
  "templateVersion": "1.1.0",
  "title": "Validation Tests",
  "purpose": "Defines automated compliance validation (Wiz policies, ICS checks), manual evidence collection (JIRA templates), and traditional test cases to verify implementation correctness",
  "criticalFeature": "COMPLIANCE VALIDATION v1.1 - Hybrid approach combining automated security scanning with structured manual evidence workflows",
  "contentStructure": {
    "introduction": {
      "purpose": "Set context for validation strategy and compliance automation approach",
      "elements": ["validation_philosophy", "automation_coverage", "manual_evidence_scope"],
      "wordCount": {"min": 50, "max": 100},
      "example": "This section defines a hybrid validation approach combining automated compliance checks (Wiz policies, AWS Config rules) with manual evidence collection workflows (JIRA ticket templates) to verify Customer PII Encryption Policy implementation. Automated checks continuously monitor 80%+ of controls (encryption at rest, key rotation, access controls), while manual evidence workflows capture quarterly attestations and exception approvals requiring human judgment."
    },
    "wizPolicies": {
      "purpose": "Define Wiz Cloud Security Platform policies for automated non-compliance detection using WizQL",
      "elements": ["wiz_policy_structure", "wizql_queries", "remediation_guidance", "compliance_framework_mapping"],
      "wordCount": {"min": 200, "max": 400},
      "guidingQuestions": [
        "What Wiz policies detect encryption configuration violations?",
        "What are the exact WizQL queries for each policy?",
        "What severity levels are assigned (CRITICAL, HIGH, MEDIUM, LOW)?",
        "What remediation steps are prescribed for violations?",
        "How do Wiz policies map to compliance frameworks (NIST, CIS, GDPR)?"
      ],
      "requiredStructure": {
        "fields": [
          "checkId",
          "requirement",
          "validationType",
          "tools",
          "wizPolicy.policyName",
          "wizPolicy.queryLanguage",
          "wizPolicy.query",
          "wizPolicy.severity",
          "wizPolicy.remediation",
          "wizPolicy.complianceFrameworks"
        ],
        "severityLevels": ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
        "queryLanguage": "wiz-ql"
      },
      "example": "**Wiz Policy 1: RDS Encryption at Rest Validation**\n\n```json\n{\n  \"checkId\": \"WIZ-POL-2025-004-001\",\n  \"requirement\": \"All RDS instances storing customer PII must have encryption at rest enabled using AWS KMS customer managed keys\",\n  \"validationType\": \"automated\",\n  \"tools\": [\"wiz\"],\n  \"wizPolicy\": {\n    \"policyName\": \"POL-2025-004: RDS Encryption at Rest Validation\",\n    \"queryLanguage\": \"wiz-ql\",\n    \"query\": \"cloudResource where type='AWS RDS Instance' AND encryptionEnabled=false AND tags.DataClassification='PII'\",\n    \"severity\": \"CRITICAL\",\n    \"remediation\": \"Enable encryption at rest on RDS instance using KMS CMK: (1) Create snapshot of existing instance, (2) Copy snapshot with encryption enabled using alias/pii-encryption-{env} KMS key, (3) Restore encrypted snapshot to new instance, (4) Update application connection strings, (5) Delete unencrypted instance after validation\",\n    \"complianceFrameworks\": [\n      {\n        \"framework\": \"NIST SP 800-53A\",\n        \"control\": \"SC-28(1)\",\n        \"description\": \"Protection of information at rest using cryptographic mechanisms\"\n      },\n      {\n        \"framework\": \"CIS AWS Foundations Benchmark\",\n        \"control\": \"2.3.1\",\n        \"description\": \"Ensure that encryption is enabled for RDS instances\"\n      },\n      {\n        \"framework\": \"GDPR\",\n        \"control\": \"Article 32\",\n        \"description\": \"Security of processing - encryption of personal data\"\n      }\n    ]\n  }\n}\n```\n\n**Wiz Policy 2: S3 Bucket Encryption Validation**\n\n```json\n{\n  \"checkId\": \"WIZ-POL-2025-004-002\",\n  \"requirement\": \"All S3 buckets storing customer PII must have default encryption enabled with KMS CMK (not SSE-S3)\",\n  \"validationType\": \"automated\",\n  \"tools\": [\"wiz\"],\n  \"wizPolicy\": {\n    \"policyName\": \"POL-2025-004: S3 Bucket KMS Encryption Validation\",\n    \"queryLanguage\": \"wiz-ql\",\n    \"query\": \"cloudResource where type='AWS S3 Bucket' AND (encryptionConfiguration.enabled=false OR encryptionConfiguration.algorithm!='aws:kms') AND tags.DataClassification='PII'\",\n    \"severity\": \"HIGH\",\n    \"remediation\": \"Configure S3 bucket default encryption: (1) Navigate to S3 bucket properties, (2) Edit default encryption settings, (3) Select AWS-KMS encryption, (4) Specify alias/pii-encryption-{env} KMS key ARN, (5) Enable bucket key to reduce KMS API costs, (6) Verify encryption applied to new objects\",\n    \"complianceFrameworks\": [\n      {\n        \"framework\": \"NIST SP 800-53A\",\n        \"control\": \"SC-28(1)\",\n        \"description\": \"Protection of information at rest\"\n      },\n      {\n        \"framework\": \"CIS AWS Foundations Benchmark\",\n        \"control\": \"2.1.1\",\n        \"description\": \"Ensure S3 bucket encryption is enabled\"\n      }\n    ]\n  }\n}\n```\n\n**Wiz Policy 3: KMS Key Rotation Validation**\n\n```json\n{\n  \"checkId\": \"WIZ-POL-2025-004-003\",\n  \"requirement\": \"All KMS customer managed keys used for PII encryption must have automatic key rotation enabled\",\n  \"validationType\": \"automated\",\n  \"tools\": [\"wiz\"],\n  \"wizPolicy\": {\n    \"policyName\": \"POL-2025-004: KMS Key Rotation Validation\",\n    \"queryLanguage\": \"wiz-ql\",\n    \"query\": \"cloudResource where type='AWS KMS Key' AND keyManager='CUSTOMER' AND keyRotationEnabled=false AND (description contains 'PII' OR tags.DataClassification='PII')\",\n    \"severity\": \"HIGH\",\n    \"remediation\": \"Enable automatic key rotation: (1) Navigate to AWS KMS console, (2) Select customer managed key, (3) Key rotation tab, (4) Enable automatic key rotation, (5) Verify rotation period is 365 days (AWS default) or configure custom rotation via Lambda for 90-day rotation per POL-2025-004 requirement\",\n    \"complianceFrameworks\": [\n      {\n        \"framework\": \"NIST SP 800-53A\",\n        \"control\": \"SC-12(1)\",\n        \"description\": \"Cryptographic key establishment and management\"\n      },\n      {\n        \"framework\": \"SOC 2\",\n        \"control\": \"CC6.1\",\n        \"description\": \"Logical and physical access controls - encryption key management\"\n      }\n    ]\n  }\n}\n```"
    },
    "icsChecks": {
      "purpose": "Define Infrastructure Configuration Scanner checks for cloud provider native compliance validation (AWS Config, GCP SCC, Azure Policy)",
      "elements": ["ics_check_structure", "check_definitions", "expected_results", "integration_config"],\n      \"wordCount\": {\"min\": 150, \"max\": 300},\n      \"guidingQuestions\": [\n        \"What AWS Config/GCP SCC/Azure Policy rules validate encryption?\",\n        \"What are the check names and cloud provider service mappings?\",\n        \"What are the expected results (PASS/FAIL criteria)?\",\n        \"How do checks integrate with existing compliance dashboards?\"\n      ],\n      \"requiredStructure\": {\n        \"fields\": [\n          \"checkName\",\n          \"cloudProvider\",\n          \"service\",\n          \"checkType\",\n          \"expectedResult\"\n        ],\n        \"cloudProviders\": [\"aws\", \"gcp\", \"azure\"],\n        \"checkTypes\": [\"security\", \"compliance\", \"configuration\"],\n        \"expectedResults\": [\"PASS\", \"FAIL\"]\n      },\n      \"example\": \"**ICS Check 1: AWS Config - Encrypted Volumes**\\n\\n```json\\n{\\n  \\\"checkName\\\": \\\"encrypted-volumes\\\",\\n  \\\"cloudProvider\\\": \\\"aws\\\",\\n  \\\"service\\\": \\\"ec2\\\",\\n  \\\"checkType\\\": \\\"security\\\",\\n  \\\"expectedResult\\\": \\\"PASS\\\",\\n  \\\"configRuleArn\\\": \\\"arn:aws:config:us-east-1:123456789012:config-rule/config-rule-encrypted-volumes\\\",\\n  \\\"description\\\": \\\"Checks whether EBS volumes attached to EC2 instances are encrypted. If an EBS volume is not attached to an instance, it is excluded from evaluation.\\\",\\n  \\\"scope\\\": {\\n    \\\"complianceResourceTypes\\\": [\\\"AWS::EC2::Volume\\\"],\\n    \\\"tagKey\\\": \\\"DataClassification\\\",\\n    \\\"tagValue\\\": \\\"PII\\\"\\n  },\\n  \\\"source\\\": {\\n    \\\"owner\\\": \\\"AWS\\\",\\n    \\\"sourceIdentifier\\\": \\\"ENCRYPTED_VOLUMES\\\"\\n  },\\n  \\\"inputParameters\\\": {\\n    \\\"kmsId\\\": \\\"alias/pii-encryption-prod\\\"\\n  },\\n  \\\"complianceFrameworks\\\": [\\n    {\\n      \\\"framework\\\": \\\"NIST SP 800-53A\\\",\\n      \\\"control\\\": \\\"SC-28(1)\\\"\\n    },\\n    {\\n      \\\"framework\\\": \\\"PCI DSS\\\",\\n      \\\"control\\\": \\\"3.4\\\"\\n    }\\n  ]\\n}\\n```\\n\\n**ICS Check 2: AWS Config - RDS Encryption at Rest**\\n\\n```json\\n{\\n  \\\"checkName\\\": \\\"rds-storage-encrypted\\\",\\n  \\\"cloudProvider\\\": \\\"aws\\\",\\n  \\\"service\\\": \\\"rds\\\",\\n  \\\"checkType\\\": \\\"security\\\",\\n  \\\"expectedResult\\\": \\\"PASS\\\",\\n  \\\"configRuleArn\\\": \\\"arn:aws:config:us-east-1:123456789012:config-rule/config-rule-rds-storage-encrypted\\\",\\n  \\\"description\\\": \\\"Checks whether storage encryption is enabled for your RDS DB instances.\\\",\\n  \\\"scope\\\": {\\n    \\\"complianceResourceTypes\\\": [\\\"AWS::RDS::DBInstance\\\"],\\n    \\\"tagKey\\\": \\\"DataClassification\\\",\\n    \\\"tagValue\\\": \\\"PII\\\"\\n  },\\n  \\\"source\\\": {\\n    \\\"owner\\\": \\\"AWS\\\",\\n    \\\"sourceIdentifier\\\": \\\"RDS_STORAGE_ENCRYPTED\\\"\\n  },\\n  \\\"inputParameters\\\": {\\n    \\\"kmsKeyId\\\": \\\"alias/pii-encryption-prod\\\"\\n  },\\n  \\\"complianceFrameworks\\\": [\\n    {\\n      \\\"framework\\\": \\\"CIS AWS Foundations Benchmark\\\",\\n      \\\"control\\\": \\\"2.3.1\\\"\\n    },\\n    {\\n      \\\"framework\\\": \\\"GDPR\\\",\\n      \\\"control\\\": \\\"Article 32\\\"\\n    }\\n  ]\\n}\\n```\\n\\n**ICS Check 3: AWS Config - S3 Bucket Server-Side Encryption**\\n\\n```json\\n{\\n  \\\"checkName\\\": \\\"s3-default-encryption-kms\\\",\\n  \\\"cloudProvider\\\": \\\"aws\\\",\\n  \\\"service\\\": \\\"s3\\\",\\n  \\\"checkType\\\": \\\"security\\\",\\n  \\\"expectedResult\\\": \\\"PASS\\\",\\n  \\\"configRuleArn\\\": \\\"arn:aws:config:us-east-1:123456789012:config-rule/config-rule-s3-default-encryption-kms\\\",\\n  \\\"description\\\": \\\"Checks that S3 buckets have default encryption enabled and use AWS KMS for encryption.\\\",\\n  \\\"scope\\\": {\\n    \\\"complianceResourceTypes\\\": [\\\"AWS::S3::Bucket\\\"],\\n    \\\"tagKey\\\": \\\"DataClassification\\\",\\n    \\\"tagValue\\\": \\\"PII\\\"\\n  },\\n  \\\"source\\\": {\\n    \\\"owner\\\": \\\"AWS\\\",\\n    \\\"sourceIdentifier\\\": \\\"S3_DEFAULT_ENCRYPTION_KMS\\\"\\n  },\\n  \\\"inputParameters\\\": {\\n    \\\"kmsKeyId\\\": \\\"alias/pii-encryption-prod\\\"\\n  },\\n  \\\"complianceFrameworks\\\": [\\n    {\\n      \\\"framework\\\": \\\"CIS AWS Foundations Benchmark\\\",\\n      \\\"control\\\": \\\"2.1.1\\\"\\n    }\\n  ]\\n}\\n```\"\n    },\n    \"jiraEvidenceTemplates\": {\n      \"purpose\": \"Define JIRA ticket templates for manual evidence collection workflows requiring human judgment or attestation\",\n      \"elements\": [\"ticket_structure\", \"evidence_requirements\", \"approval_workflow\", \"frequency_schedule\"],\n      \"wordCount\": {\"min\": 200, \"max\": 400},\n      \"guidingQuestions\": [\n        \"What manual evidence requires human collection (attestations, approvals, documentation)?\",\n        \"What are the JIRA ticket field specifications (project, issue type, custom fields)?\",\n        \"What evidence formats are required (PDF, screenshots, log exports)?\",\n        \"What is the collection frequency (quarterly, annual, on-demand)?\",\n        \"Who owns evidence collection (Security team, Compliance team, Engineering)?\"\n      ],\n      \"requiredStructure\": {\n        \"fields\": [\n          \"checkId\",\n          \"requirement\",\n          \"validationType\",\n          \"evidenceRequired.type\",\n          \"evidenceRequired.formats\",\n          \"evidenceRequired.description\",\n          \"evidenceRequired.frequency\",\n          \"evidenceRequired.nextDueDate\",\n          \"evidenceRequired.owner\",\n          \"evidenceRequired.jiraTicket.project\",\n          \"evidenceRequired.jiraTicket.issueType\",\n          \"evidenceRequired.jiraTicket.template\",\n          \"evidenceRequired.jiraTicket.labels\"\n        ],\n        \"evidenceTypes\": [\"document\", \"screenshot\", \"log\", \"attestation\"],\n        \"frequencies\": [\"daily\", \"weekly\", \"monthly\", \"quarterly\", \"annual\"]\n      },\n      \"example\": \"**JIRA Evidence Template 1: Quarterly KMS Key Rotation Attestation**\\n\\n```json\\n{\\n  \\\"checkId\\\": \\\"JIRA-POL-2025-004-001\\\",\\n  \\\"requirement\\\": \\\"Cryptographic keys used for customer PII encryption must be rotated every 90 days per POL-2025-004 Section 4-2\\\",\\n  \\\"validationType\\\": \\\"manual\\\",\\n  \\\"evidenceRequired\\\": {\\n    \\\"type\\\": \\\"attestation\\\",\\n    \\\"formats\\\": [\\\"pdf\\\", \\\"docx\\\"],\\n    \\\"description\\\": \\\"Signed attestation from Security Operations Manager confirming: (1) All KMS customer managed keys tagged with DataClassification=PII have rotated within 90 days, (2) No key rotation failures occurred, (3) Application functionality verified post-rotation, (4) Exception list reviewed and approved\\\",\\n    \\\"frequency\\\": \\\"quarterly\\\",\\n    \\\"nextDueDate\\\": \\\"2025-04-01\\\",\\n    \\\"owner\\\": \\\"Security Operations Manager\\\",\\n    \\\"jiraTicket\\\": {\\n      \\\"project\\\": \\\"SEC\\\",\\n      \\\"issueType\\\": \\\"Evidence Request\\\",\\n      \\\"template\\\": {\\n        \\\"summary\\\": \\\"Q1 2025: KMS Key Rotation Attestation - POL-2025-004\\\",\\n        \\\"description\\\": \\\"## Evidence Request\\\\n\\\\n**Policy:** POL-2025-004 Customer PII Encryption Policy\\\\n**Control:** Key Rotation (Section 4-2)\\\\n**Frequency:** Quarterly\\\\n**Due Date:** April 1, 2025\\\\n\\\\n## Required Evidence\\\\n\\\\nPlease provide a signed attestation confirming:\\\\n\\\\n1. **Key Rotation Verification**: All AWS KMS customer managed keys tagged with `DataClassification=PII` have undergone automatic or manual rotation within the past 90 days\\\\n2. **Failure Review**: No key rotation failures occurred during the quarter (January 1 - March 31, 2025)\\\\n3. **Application Validation**: Post-rotation testing confirmed no application encryption/decryption errors\\\\n4. **Exception Handling**: Any keys exempt from rotation have documented and approved exceptions\\\\n\\\\n## Evidence Format\\\\n\\\\n- **Document Type**: PDF or DOCX\\\\n- **Signed By**: Security Operations Manager\\\\n- **Includes**: KMS key rotation report from AWS console (CloudWatch Logs export)\\\\n\\\\n## Compliance Mapping\\\\n\\\\n- **NIST SP 800-53A**: SC-12(1) - Cryptographic key establishment and management\\\\n- **SOC 2**: CC6.1 - Logical and physical access controls\\\\n- **GDPR**: Article 32 - Security of processing\\\\n\\\",\\n        \\\"priority\\\": \\\"High\\\",\\n        \\\"dueDate\\\": \\\"2025-04-01\\\",\\n        \\\"assignee\\\": \\\"security-ops-manager\\\",\\n        \\\"customFields\\\": {\\n          \\\"PolicyID\\\": \\\"POL-2025-004\\\",\\n          \\\"ControlSection\\\": \\\"4-2\\\",\\n          \\\"ComplianceFrameworks\\\": [\\\"NIST SP 800-53A\\\", \\\"SOC 2\\\", \\\"GDPR\\\"],\\n          \\\"EvidenceType\\\": \\\"Attestation\\\",\\n          \\\"Frequency\\\": \\\"Quarterly\\\"\\n        }\\n      },\\n      \\\"labels\\\": [\\\"pii-encryption\\\", \\\"key-rotation\\\", \\\"quarterly-evidence\\\", \\\"POL-2025-004\\\"]\\n    }\\n  }\\n}\\n```\\n\\n**JIRA Evidence Template 2: Annual CloudHSM Firmware Attestation**\\n\\n```json\\n{\\n  \\\"checkId\\\": \\\"JIRA-POL-2025-004-002\\\",\\n  \\\"requirement\\\": \\\"CloudHSM clusters must run FIPS 140-2 Level 3 validated firmware with latest security patches\\\",\\n  \\\"validationType\\\": \\\"manual\\\",\\n  \\\"evidenceRequired\\\": {\\n    \\\"type\\\": \\\"document\\\",\\n    \\\"formats\\\": [\\\"pdf\\\"],\\n    \\\"description\\\": \\\"AWS CloudHSM cluster firmware verification report including: (1) Current firmware version, (2) FIPS 140-2 Level 3 certificate number, (3) Last firmware update date, (4) Screenshot of HSM cluster details from AWS console\\\",\\n    \\\"frequency\\\": \\\"annual\\\",\\n    \\\"nextDueDate\\\": \\\"2025-12-31\\\",\\n    \\\"owner\\\": \\\"Cloud Infrastructure Team\\\",\\n    \\\"jiraTicket\\\": {\\n      \\\"project\\\": \\\"SEC\\\",\\n      \\\"issueType\\\": \\\"Evidence Request\\\",\\n      \\\"template\\\": {\\n        \\\"summary\\\": \\\"2025 Annual: CloudHSM FIPS 140-2 Firmware Attestation - POL-2025-004\\\",\\n        \\\"description\\\": \\\"## Evidence Request\\\\n\\\\n**Policy:** POL-2025-004 Customer PII Encryption Policy\\\\n**Control:** HSM Firmware Validation\\\\n**Frequency:** Annual\\\\n**Due Date:** December 31, 2025\\\\n\\\\n## Required Evidence\\\\n\\\\nPlease provide documentation confirming:\\\\n\\\\n1. **Firmware Version**: Current firmware version running on all CloudHSM instances in cluster-pii-encryption-prod\\\\n2. **FIPS Certification**: FIPS 140-2 Level 3 certificate number and validation date\\\\n3. **Patch Status**: Confirmation that all security patches are applied\\\\n4. **Console Screenshot**: AWS console screenshot showing HSM cluster details\\\\n\\\\n## Evidence Format\\\\n\\\\n- **Document Type**: PDF report\\\\n- **Includes**: AWS console screenshots, FIPS certificate reference\\\\n- **Signed By**: Cloud Infrastructure Manager\\\\n\\\",\\n        \\\"priority\\\": \\\"Medium\\\",\\n        \\\"dueDate\\\": \\\"2025-12-31\\\",\\n        \\\"assignee\\\": \\\"cloud-infra-team\\\",\\n        \\\"customFields\\\": {\\n          \\\"PolicyID\\\": \\\"POL-2025-004\\\",\\n          \\\"ControlSection\\\": \\\"4-3\\\",\\n          \\\"ComplianceFrameworks\\\": [\\\"NIST SP 800-53A\\\", \\\"FIPS 140-2\\\"],\\n          \\\"EvidenceType\\\": \\\"Document\\\",\\n          \\\"Frequency\\\": \\\"Annual\\\"\\n        }\\n      },\\n      \\\"labels\\\": [\\\"cloudhsm\\\", \\\"fips-140-2\\\", \\\"annual-evidence\\\", \\\"POL-2025-004\\\"]\\n    }\\n  }\\n}\\n```\"\n    },\n    \"traditionalTestCases\": {\n      \"purpose\": \"Define traditional unit/integration test cases for implementation validation (pytest, jest)\",\n      \"elements\": [\"unit_tests\", \"integration_tests\", \"security_tests\", \"performance_tests\"],\n      \"wordCount\": {\"min\": 150, \"max\": 300},\n      \"guidingQuestions\": [\n        \"What unit tests validate encryption library functionality?\",\n        \"What integration tests verify KMS integration?\",\n        \"What security tests confirm encryption strength?\",\n        \"What performance tests measure encryption latency?\"\n      ],\n      \"example\": \"**Unit Test: AWS Encryption SDK Configuration (pytest)**\\n\\n```python\\nimport pytest\\nimport boto3\\nfrom aws_encryption_sdk import EncryptionSDKClient, CommitmentPolicy\\nfrom aws_encryption_sdk.key_providers.kms import KMSMasterKeyProvider\\n\\n\\nclass TestPIIEncryption:\\n    \\\"\\\"\\\"Test suite for POL-2025-004 PII encryption implementation.\\\"\\\"\\\"\\n    \\n    @pytest.fixture\\n    def kms_key_arn(self):\\n        \\\"\\\"\\\"KMS key ARN for testing (from environment variable).\\\"\\\"\\\"\\n        return os.environ.get('KMS_PII_KEY_ARN', 'arn:aws:kms:us-east-1:123456789012:key/test-key')\\n    \\n    @pytest.fixture\\n    def encryption_client(self, kms_key_arn):\\n        \\\"\\\"\\\"Initialize AWS Encryption SDK client.\\\"\\\"\\\"\\n        key_provider = KMSMasterKeyProvider(key_ids=[kms_key_arn])\\n        return EncryptionSDKClient(commitment_policy=CommitmentPolicy.REQUIRE_ENCRYPT_REQUIRE_DECRYPT)\\n    \\n    def test_encrypt_decrypt_customer_pii(self, encryption_client, kms_key_arn):\\n        \\\"\\\"\\\"Test encryption and decryption of customer PII data.\\\"\\\"\\\"\\n        # Arrange\\n        plaintext_pii = b\\\"customer_email=john.doe@example.com,ssn=123-45-6789\\\"\\n        encryption_context = {\\n            'purpose': 'customer-pii-encryption',\\n            'policy': 'POL-2025-004',\\n            'data_classification': 'PII'\\n        }\\n        \\n        # Act - Encrypt\\n        ciphertext, encryptor_header = encryption_client.encrypt(\\n            source=plaintext_pii,\\n            encryption_context=encryption_context,\\n            key_provider=KMSMasterKeyProvider(key_ids=[kms_key_arn])\\n        )\\n        \\n        # Assert - Verify encryption\\n        assert ciphertext != plaintext_pii, \\\"Ciphertext must differ from plaintext\\\"\\n        assert len(ciphertext) > len(plaintext_pii), \\\"Ciphertext should include metadata\\\"\\n        \\n        # Act - Decrypt\\n        decrypted_plaintext, decryptor_header = encryption_client.decrypt(\\n            source=ciphertext,\\n            key_provider=KMSMasterKeyProvider(key_ids=[kms_key_arn])\\n        )\\n        \\n        # Assert - Verify decryption\\n        assert decrypted_plaintext == plaintext_pii, \\\"Decrypted text must match original\\\"\\n        assert decryptor_header.encryption_context == encryption_context\\n    \\n    def test_encryption_context_validation(self, encryption_client, kms_key_arn):\\n        \\\"\\\"\\\"Test that encryption context is enforced per POL-2025-004.\\\"\\\"\\\"\\n        plaintext = b\\\"test-data\\\"\\n        \\n        # Encrypt with required context\\n        ciphertext, _ = encryption_client.encrypt(\\n            source=plaintext,\\n            encryption_context={'purpose': 'customer-pii-encryption', 'policy': 'POL-2025-004'},\\n            key_provider=KMSMasterKeyProvider(key_ids=[kms_key_arn])\\n        )\\n        \\n        # Attempt decrypt with wrong context should fail\\n        with pytest.raises(Exception):  # AWS Encryption SDK raises on context mismatch\\n            encryption_client.decrypt(\\n                source=ciphertext,\\n                encryption_context={'purpose': 'wrong-context'},\\n                key_provider=KMSMasterKeyProvider(key_ids=[kms_key_arn])\\n            )\\n```\\n\\n**Integration Test: S3 Encryption Verification**\\n\\n```python\\nimport boto3\\nimport pytest\\n\\n\\nclass TestS3EncryptionIntegration:\\n    \\\"\\\"\\\"Integration tests for S3 bucket encryption (POL-2025-004).\\\"\\\"\\\"\\n    \\n    @pytest.fixture\\n    def s3_client(self):\\n        return boto3.client('s3', region_name='us-east-1')\\n    \\n    @pytest.fixture\\n    def test_bucket_name(self):\\n        return os.environ.get('TEST_S3_BUCKET', 'pii-customer-data-test')\\n    \\n    def test_s3_default_encryption_enabled(self, s3_client, test_bucket_name):\\n        \\\"\\\"\\\"Verify S3 bucket has default KMS encryption enabled.\\\"\\\"\\\"\\n        # Act\\n        response = s3_client.get_bucket_encryption(Bucket=test_bucket_name)\\n        \\n        # Assert\\n        rules = response['ServerSideEncryptionConfiguration']['Rules']\\n        assert len(rules) > 0, \\\"Bucket must have encryption rules\\\"\\n        \\n        default_encryption = rules[0]['ApplyServerSideEncryptionByDefault']\\n        assert default_encryption['SSEAlgorithm'] == 'aws:kms', \\\"Must use KMS encryption\\\"\\n        assert 'KMSMasterKeyID' in default_encryption, \\\"KMS key must be specified\\\"\\n        assert 'pii-encryption' in default_encryption['KMSMasterKeyID'], \\\"Must use PII encryption key\\\"\\n    \\n    def test_s3_object_upload_with_encryption(self, s3_client, test_bucket_name):\\n        \\\"\\\"\\\"Verify uploaded objects are encrypted with KMS.\\\"\\\"\\\"\\n        # Arrange\\n        test_key = 'test-pii-data.txt'\\n        test_data = b'customer_email=test@example.com'\\n        \\n        # Act\\n        s3_client.put_object(\\n            Bucket=test_bucket_name,\\n            Key=test_key,\\n            Body=test_data\\n        )\\n        \\n        # Assert - Verify object encryption\\n        response = s3_client.head_object(Bucket=test_bucket_name, Key=test_key)\\n        assert response['ServerSideEncryption'] == 'aws:kms', \\\"Object must be KMS encrypted\\\"\\n        assert 'SSEKMSKeyId' in response, \\\"KMS key ID must be present\\\"\\n        \\n        # Cleanup\\n        s3_client.delete_object(Bucket=test_bucket_name, Key=test_key)\\n```\"\n    }\n  },\n  \"upstreamTraceability\": {\n    \"requiredReferences\": [\n      {\n        \"section\": \"4-1\",\n        \"relationship\": \"validates\",\n        \"rationale\": \"Validation tests verify implementation specifications are correctly deployed\"\n      },\n      {\n        \"section\": \"4-2\",\n        \"relationship\": \"validates\",\n        \"rationale\": \"Automated checks and manual evidence confirm procedures are followed\"\n      },\n      {\n        \"section\": \"4-3\",\n        \"relationship\": \"validates\",\n        \"rationale\": \"Test cases verify technical standards compliance (AES-256, TLS 1.2+)\"\n      }\n    ],\n    \"exampleTraceabilityEntry\": {\n      \"sectionId\": \"5-3\",\n      \"references\": [\n        {\n          \"targetSection\": \"POL-2025-004.physical.4-1\",\n          \"relationship\": \"validates\",\n          \"description\": \"Wiz policy WIZ-POL-2025-004-001 validates Section 4-1 RDS encryption specification by continuously scanning for unencrypted RDS instances tagged with DataClassification=PII\"\n        },\n        {\n          \"targetSection\": \"POL-2025-004.physical.4-2\",\n          \"relationship\": \"validates\",\n          \"description\": \"JIRA evidence template JIRA-POL-2025-004-001 validates Section 4-2 90-day key rotation procedure through quarterly attestations from Security Operations Manager\"\n        }\n      ]\n    }\n  },\n  \"frameworkReferences\": [\n    {\n      \"framework\": \"NIST SP 800-53A\",\n      \"control\": \"CA-2\",\n      \"relevance\": \"Security assessments including automated security control assessments\"\n    },\n    {\n      \"framework\": \"NIST SP 800-53A\",\n      \"control\": \"CA-7\",\n      \"relevance\": \"Continuous monitoring using automated tools (Wiz, AWS Config)\"\n    },\n    {\n      \"framework\": \"CIS Controls\",\n      \"control\": \"3.11\",\n      \"relevance\": \"Validation that encryption is enabled for sensitive data at rest\"\n    },\n    {\n      \"framework\": \"SOC 2\",\n      \"control\": \"CC4.1\",\n      \"relevance\": \"Monitoring activities including automated compliance checks\"\n    }\n  ],\n  \"qualityChecks\": {\n    \"completeness\": [\n      \"All validation subsections present (Wiz policies, ICS checks, JIRA templates, traditional tests)\",\n      \"Minimum 3 Wiz policies with complete WizQL queries\",\n      \"Minimum 2 ICS checks (AWS Config/GCP SCC/Azure Policy)\",\n      \"Minimum 2 JIRA evidence templates with 11+ fields\",\n      \"Minimum 2 traditional test cases (unit/integration)\",\n      \"Minimum word count met (800-1500 total)\"\n    ],\n    \"complianceValidationV1_1\": [\n      \"Wiz policies include all 6 required fields (policyName, queryLanguage, query, severity, remediation, complianceFrameworks)\",\n      \"WizQL queries are syntactically valid and executable\",\n      \"ICS checks include all 5 required fields (checkName, cloudProvider, service, checkType, expectedResult)\",\n      \"JIRA templates include all 11 required fields per specification\",\n      \"Evidence collection frequency and ownership clearly defined\"\n    ],\n    \"traceability\": [\n      \"Minimum 3 upstream references to Layer 4 sections (4-1, 4-2, 4-3)\",\n      \"All validation checks map to specific upstream specifications\",\n      \"Relationship type 'validates' correctly applied\"\n    ],\n    \"frameworkAlignment\": [\n      \"Minimum 3 framework citations (NIST, CIS, SOC 2)\",\n      \"Compliance framework mapping in Wiz policies is accurate\",\n      \"Validation approach satisfies continuous monitoring requirements\"\n    ]\n  },\n  \"commonPitfalls\": [\n    \"Incomplete Wiz policy structure (missing remediation or complianceFrameworks fields)\",\n    \"Invalid WizQL syntax (query not executable in Wiz platform)\",\n    \"JIRA evidence templates missing required fields (frequency, owner, nextDueDate)\",\n    \"Traditional test cases that don't actually validate encryption (testing non-security functionality)\",\n    \"No mapping between automated checks and compliance frameworks\",\n    \"Hardcoded resource ARNs or account IDs in test code\"\n  ],\n  \"exampleOutput\": {\n    \"rationale\": \"The validation tests specified in this section provide a hybrid compliance validation approach combining automated security scanning with manual evidence workflows. Wiz policies WIZ-POL-2025-004-001 through WIZ-POL-2025-004-003 validate Section 4-1 implementation specifications by continuously monitoring RDS encryption, S3 bucket encryption, and KMS key rotation using WizQL queries. ICS checks (AWS Config rules) provide cloud-native compliance validation for the same controls. JIRA evidence templates JIRA-POL-2025-004-001 and JIRA-POL-2025-004-002 validate Section 4-2 procedural requirements (quarterly key rotation attestation, annual HSM firmware verification) through structured manual evidence collection workflows. Traditional test cases (pytest integration tests) validate Section 4-3 technical standards by verifying AES-256-GCM encryption implementation and S3 KMS integration. This comprehensive validation approach aligns with NIST SP 800-53A CA-7 (continuous monitoring) and SOC 2 CC4.1 (monitoring activities).\"\n  }\n}\n